var Questions={Views:{Categories:{}},Controllers:{},Collections:{},categories:{},init:function(){new Questions.Controllers.Categories();Backbone.history.start()}};Questions.Category=Backbone.Model.extend({localStorage:new Store("categories")});Questions.Collections.Categories=Backbone.Collection.extend({model:Questions.Category,localStorage:new Store("categories")});Questions.CollectionView=Backbone.View.extend({initialize:function(a){_(this).bindAll("add","remove");if(!a.childViewConstructor){throw"No child view constructor provided"}if(!a.childViewTagName){throw"No child view tag name provided"}this._childViewConstructor=a.childViewConstructor;this._childViewTagName=a.childViewTagName;this._childViews=[];this.collection.each(this.add);this.collection.bind("add",this.add);this.collection.bind("remove",this.remove);this.render()},add:function(a){var b=new this._childViewConstructor({tagName:this._childViewTagName,model:a});this._childViews.push(b);if(this._rendered){$(this.el).append(b.render().el)}},remove:function(a){var b=_(this._childViews).select(function(c){return c.model===a})[0];this._childViews=_(this._childViews).without(b);if(this._rendered){$(b.el).remove()}},render:function(){var a=this;this._rendered=true;$(this.el).empty();_(this._childViews).each(function(b){$(a.el).append(b.render().el)});return this}});Questions.Controllers.Categories=Backbone.Controller.extend({routes:{"":"index","!/categories/new":"build","!/categories/:id":"edit"},index:function(){if(this.categories){return}var a=this;this.categories=new Questions.Collections.Categories();this.categories.fetch({success:function(){new Questions.CollectionView({collection:a.categories,childViewConstructor:Questions.Views.Categories.Show,childViewTagName:"li",el:$("#questions ul")[0]})},error:function(){new Error({message:"Error loading categories."})}})},build:function(){if(!this._requireCollection()){return}new Questions.Views.Categories.Edit({model:new Questions.Category(),collection:this.categories})},edit:function(b){if(!this._requireCollection()){return}var a=this.categories.get(b);if(a){new Questions.Views.Categories.Edit({model:a})}else{new Error({message:"Could not find that category."});window.location.hash="#"}},_requireCollection:function(){if(!this.categories){window.location.hash="#"}return !!this.categories}});Questions.Views.Categories.Show=Backbone.View.extend({events:{click:"edit"},initialize:function(a){this.render=_.bind(this.render,this);this.model.bind("change",this.render)},render:function(){$(this.el).html($(ich.categoryShow(this.model.toJSON())));return this},edit:function(){new Questions.Views.Categories.Edit({model:this.model})}});Questions.Views.Categories.Edit=Backbone.View.extend({events:{"click .save":"save","click .delete":"remove"},initialize:function(){_.bindAll(this,"render");this.render()},save:function(){var a=this.model.isNew();var b=this;this.model.save({name:this.$("[name=name]").val(),description:this.$("[name=description]").val()},{success:function(){if(a){b.collection.add(b.model)}},error:function(){}})},remove:function(){this.model.destroy()},render:function(){$(this.el).html($(ich.categoryEdit(this.model.toJSON())));$.facebox(this.el)}});