var Questions={Views:{Categories:{}},Controllers:{},Collections:{},init:function(){new Questions.Controllers.Categories();Backbone.history.start()}};Questions.Category=Backbone.Model.extend({localStorage:new Store("categories")});Questions.Collections.Categories=Backbone.Collection.extend({model:Questions.Category,localStorage:new Store("categories")});Questions.Controllers.Categories=Backbone.Controller.extend({routes:{"":"index","!/categories/new":"build","!/categories/:id":"edit"},edit:function(b){var a=new Questions.Category({id:b});a.fetch({success:function(c,d){new Questions.Views.Categories.Edit({model:a})},error:function(){new Error({message:"Could not find that category."});window.location.hash="#"}})},index:function(){var a=new Questions.Collections.Categories();a.fetch({success:function(){new Questions.Views.Categories.Index({collection:a})},error:function(){new Error({message:"Error loading categories."})}})},build:function(){new Questions.Views.Categories.Edit({model:new Questions.Category()})}});Questions.Views.Categories.Index=Backbone.View.extend({initialize:function(){this.categories=this.options.collection;this.render()},render:function(){$(this.el).html($(ich.categoryIndex({categories:this.categories.toJSON()})));$("#questions").html(this.el)}});Questions.Views.Categories.Edit=Backbone.View.extend({events:{"submit form":"save"},initialize:function(){this.render()},save:function(){var a=this;var b=this.model.isNew()?"Successfully created!":"Saved!";this.model.save({name:this.$("[name=name]").val(),description:this.$("[name=description]").val()},{success:function(c,d){new Questions.Views.Notice({message:b});a.model=c;a.render();a.delegateEvents();Backbone.history.saveLocation("!/categories/"+c.id)},error:function(){new Questions.Views.Error()}});return false},render:function(){$(this.el).html($(ich.categoryEdit(this.model.toJSON())));$("#questions").html(this.el);this.$("[name=name]").val(this.model.get("name"))}});