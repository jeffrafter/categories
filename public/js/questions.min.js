var Questions={Views:{Categories:{}},Controllers:{},Collections:{},init:function(){new Questions.Controllers.Categories();Backbone.history.start()}};Questions.Category=Backbone.Model.extend({localStorage:new Store("categories")});Questions.Collections.Categories=Backbone.Collection.extend({model:Questions.Category,localStorage:new Store("categories")});Questions.Controllers.Categories=Backbone.Controller.extend({routes:{"":"index","!/categories/:id":"edit","!/categories/new":"build"},edit:function(b){console.log("Editing: "+b);var a=new Questions.Category({id:b});a.fetch({success:function(c,d){new Questions.Views.Categories.Edit({model:a})},error:function(){new Error({message:"Could not find that category."});window.location.hash="#"}})},index:function(){var a=new Questions.Collections.Categories();a.fetch({success:function(){new Questions.Views.Categories.Index({collection:a})},error:function(){new Error({message:"Error loading categories."})}})},build:function(){new Questions.Views.Categories.Edit({model:new Questions.Category()})}});var tmp=null;Questions.Views.Categories.Index=Backbone.View.extend({initialize:function(){this.categories=this.options.collection;this.render()},render:function(){if(this.categories.length>0){var a="<h3><a href='#!/categories/new'>Create New</a></h3><ul>";_(this.categories.models).each(function(b){a+="<li><a href='#!/categories/"+b.id+"'>"+b.escape("name")+"</a></li>"});a+="</ul>"}else{a="<h3>No categories! <a href='#!/categories/new'>Create one</a></h3>"}$(this.el).html(a);$("#questions").html(this.el)}});Questions.Views.Categories.Edit=Backbone.View.extend({events:{"submit form":"save"},initialize:function(){this.render()},save:function(){var a=this;var b=this.model.isNew()?"Successfully created!":"Saved!";this.model.save({name:this.$("[name=name]").val(),description:this.$("[name=description]").val()},{success:function(c,d){new Questions.Views.Notice({message:b});a.model=c;a.render();a.delegateEvents();Backbone.history.saveLocation("!/categories/"+c.id)},error:function(){new Questions.Views.Error()}});return false},render:function(){var a="<form>";a+="<label for='name'>Name</label>";a+="<input name='name' type='text' />";a+="<label for='description'>Description</label>";a+="<textarea name='description'>"+(this.model.escape("description")||"")+"</textarea>";var b=this.model.isNew()?"Create":"Save";a+="<button>"+b+"</button>";a+="</form>";$(this.el).html(a);$("#questions").html(this.el);this.$("[name=name]").val(this.model.get("name"))}});